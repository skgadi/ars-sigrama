function openSerialPort(e){if(e){if(serialPortDevice){if(serialPortDevice.path===e&&serialPortDevice.isOpen)return void console.log("already open");serialPortDevice.close(),console.log("closed serial port")}serialPortDevice=new SerialPort({path:e,baudRate:115200})}else console.log("no serial port id")}function sleep(e){return new Promise(r=>setTimeout(r,e))}const{app:app,BrowserWindow:BrowserWindow}=require("electron"),path=require("path");require("electron-squirrel-startup")&&app.quit();const createWindow=()=>{const e=new BrowserWindow({width:800,height:600,webPreferences:{preload:path.join(__dirname,"preload.js")}});e.maximize(),e.loadFile(path.join(__dirname,"index.html")),e.removeMenu()};app.on("ready",createWindow),app.on("window-all-closed",()=>{"darwin"!==process.platform&&app.quit()}),app.on("activate",()=>{0===BrowserWindow.getAllWindows().length&&createWindow()});const{ipcMain:ipcMain}=require("electron"),{SerialPort:SerialPort}=require("serialport");let serialPortDevice=null;ipcMain.handle("serial-port",async(e,r)=>{if(console.log("serial-port",r),0===r.c)return SerialPort.list();if(1===r.c){openSerialPort(r.path),await sleep(100),serialPortDevice.write(r.data),await sleep(150);let e=[],i=serialPortDevice.read();for(;null!=i;)await sleep(10),e.push(i),i=serialPortDevice.read();return e}});